import asyncio
from tiktok_manager import TikTokManager
from tiktok_cookies_loader import CookiesLoader
import config

async def main():
    print("–ó–∞–ø—É—Å–∫ TikTok Auto Upload")
    print("=" * 50)
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ TikTok
    manager = TikTokManager()
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–∫—Å–∏
    if manager.use_free_proxy:
        print("üìä –†–µ–∂–∏–º: –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ø–æ–∏—Å–∫)")
        print()
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ cookies
    cookies_loader = CookiesLoader()
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å –∫—É–∫–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    # –ï—Å–ª–∏ PROCESS_VALID_FIRST=true, —Å–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º valid_ —Ñ–∞–π–ª—ã
    if config.PROCESS_VALID_FIRST:
        print("–†–µ–∂–∏–º: —Å–Ω–∞—á–∞–ª–∞ valid_ —Ñ–∞–π–ª—ã, –ø–æ—Ç–æ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ")
        cookie_files = cookies_loader.get_cookie_files_with_valid_priority()
    else:
        print("–†–µ–∂–∏–º: —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã")
        cookie_files = cookies_loader.get_cookie_files()
    
    if not cookie_files:
        print("–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ —Å –∫—É–∫–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
        return
    
    print(f"–ù–∞–π–¥–µ–Ω–æ {len(cookie_files)} —Ñ–∞–π–ª–æ–≤ —Å –∫—É–∫–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å –∫—É–∫–∞–º–∏
    for i, cookie_file in enumerate(cookie_files):
        print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ {cookie_file}...")
        
        # –†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –∏–∑ –ø—É–ª–∞
        if manager.use_free_proxy:
            manager.proxy = None  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏, —Å–ª–µ–¥—É—é—â–∏–π –±—É–¥–µ—Ç –≤–∑—è—Ç –∏–∑ –ø—É–ª–∞
            print("üîÑ –ü—Ä–æ–∫—Å–∏ –±—É–¥–µ—Ç –≤–∑—è—Ç —Å–ª–µ–¥—É—é—â–∏–π –∏–∑ –ø—É–ª–∞")
        
        try:
            await manager.process_account(cookie_file)
            print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ {cookie_file} –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
            if i < len(cookie_files) - 1:
                delay = 3  # 3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
                print(f"–û–∂–∏–¥–∞–Ω–∏–µ {delay} —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞...")
                await asyncio.sleep(delay)
        except Exception as e:
            if "PROXY_PAYMENT_REQUIRED" in str(e):
                # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ - –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π –ø—Ä–æ–∫—Å–∏
                print("\n" + "=" * 80)
                print("‚ïî" + "=" * 78 + "‚ïó")
                print("‚ïë" + " " * 78 + "‚ïë")
                print("‚ïë" + " " * 20 + "–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ü–†–û–ö–°–ò!" + " " * 31 + "‚ïë")
                print("‚ïë" + " " * 78 + "‚ïë")
                print("‚ïë" + " " * 10 + "–ü–†–û–ë–õ–ï–ú–ê –° –û–ü–õ–ê–¢–û–ô –ü–†–û–ö–°–ò (HTTP 402 - Payment Required)" + " " * 12 + "‚ïë")
                print("‚ïë" + " " * 78 + "‚ïë")
                print("‚ïë" + " " * 15 + "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:" + " " * 28 + "‚ïë")
                print("‚ïë" + " " * 20 + "1. –ë–∞–ª–∞–Ω—Å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å–∞" + " " * 33 + "‚ïë")
                print("‚ïë" + " " * 20 + "2. –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏" + " " * 39 + "‚ïë")
                print("‚ïë" + " " * 20 + "3. –õ–∏–º–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è" + " " * 35 + "‚ïë")
                print("‚ïë" + " " * 78 + "‚ïë")
                print("‚ïö" + "=" * 78 + "‚ïù")
                print("=" * 80 + "\n")
                break
            else:
                # –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
                print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ {cookie_file}: {str(e)}")
                continue
    
    print("=" * 50)
    print("–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —Å –∫—É–∫–∞–º–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")


if __name__ == "__main__":
    asyncio.run(main()) 